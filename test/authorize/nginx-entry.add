#!bin/bash 

if [ "$CA_PASSWORD_ROOT" != "" ]
   then
      /etc/ca/bin/ca.script mk_root_ca         00                           "$CA_PASSWORD_ROOT"
      /etc/ca/bin/ca.script mk_intermediate_ca 00 "$CA_PASSWORD_INTERDIATE" "$CA_PASSWORD_ROOT"
   fi

if [ "${START_NGNIX#[yYjJ]}" != "$START_NGINX" ]
   then
      ##### $START_NGINX is yes, Yes, Ja or ja, so continue starting nginx
      [ -r /etc/default/nginx ] &&  . /etc/default/nginx
      sed   -e "s;%%RP_Dir%%;$RP_Dir;g" \
            -e "s;%%CA_Dir%%;$CA_Dir;g" \
            -e "s;%%RP_Name%%;$RP_Name;g" \
      <         /etc/nginx/default.conf.template \
      >         /etc/nginx/sites-enabled/default
      chmod 644 /etc/nginx/sites-enabled/default
      test -f   $CA_Dir/permission.info \
      || cp     /etc/nginx/perm.info.xmpl \
                $CA_Dir/permission.info
      /etc/nginx/perm.sh  \
                $CA_Dir/permission.info \
                $CA_Dir/permission.conf
      #
      if [ ! -f $CA_Dir/htpasswd ]
         then
            cp /etc/nginx/htpasswd.xmpl   $CA_Dir/htpasswd
         fi
      nginx
   fi
